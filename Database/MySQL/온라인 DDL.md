# 온라인 DDL

## 주요 알고리즘

### ALGORITHM=INSTANT (MySQL 8.0.12 이상):
-	테이블의 **메타데이터만 변경**하며, 실제 기존 행의 데이터는 수정하지 않습니다.
- **컬럼 추가와 같은 일부 작업**에만 적용 가능하며, 매우 빠르게 수행됩니다.
  - nullable 컬럼 추가 (기본값 없음 또는 default 지정된 경우)
  - AFTER 없이 테이블 마지막에 컬럼 추가
  - COMMENT 변경 등
-	DML(INSERT, UPDATE, DELETE) 작업과의 충돌이 거의 없습니다.
- 동시성 유지
  - 컬럼 추가 작업 중에도 다른 세션에서의 읽기 및 쓰기 작업이 가능
- 기본값 처리
  - 새로 추가된 컬럼에 대해 기본값이 지정된 경우, 기존 행들은 해당 값을 물리적으로 저장하지 않지만, **조회 시에는 기본값으로 표시**됩니다. 
  - NOT NULl 컬럼일 경우 명시적인 DEFAULT 값 지정 필수
  - NULL 허용 컬럼의 경우, 기본값이 지정되지 않으면 **조회 시 NULL**로 표시

### ALGORITHM=INPLACE:
-	테이블을 복사하지 않고, **기존 테이블에 직접 변경을 적용**합니다.
-	**대부분의 스키마 변경 작업**에 사용되며, **DML 작업과 병행하여 수행**할 수 있습니다.
-	일부 작업에서는 테이블의 재구성이 필요할 수 있습니다.
- 인덱스 추가는 메타데이터만으로는 불가능
  - 반드시 실제 데이터에 대해 B+Tree 인덱스 구조를 생성하고 삽입해야 하므로 INPLACE 알고리즘 사용해야됨
- 지원 여부 확인
  - SHOW CREATE TABLE {테이블명}
  - **ENGINE=InnoDB**이고 **ROW_FORMAT=Dynamic** 또는 **Compact** 인 경우 (명시적 ROW_FORMAT 없음 → 기본은 DYNAMIC 또는 COMPACT) 대부분 지원

### ALGORITHM=COPY:
- 새로운 테이블을 생성하고 데이터를 복사한 후, 원본 테이블을 교체합니다.
- 가장 오래되고 리소스를 많이 사용하는 방식으로, **DML 작업이 차단**됩니다.
- 가능한 한 피하는 것이 좋습니다.
- 데이터 타입 변경: 컬럼의 데이터 타입을 변경하는 경우, INPLACE 알고리즘이 지원되지 않을 수 있습니다.
- 컬럼 순서 변경: 컬럼의 순서를 변경하는 경우, 테이블을 재구성해야 하므로 COPY 알고리즘이 필요합니다.
- 특정 인덱스 추가: 예를 들어, 다중 값 인덱스(Multi-Valued Index)를 추가하는 경우, COPY 알고리즘만 지원됩니다.


## LOCK 옵션

- LOCK=NONE
  - DML 및 SELECT 작업이 **모두 허용**됩니다.
- LOCK=SHARED
  - **SELECT는 허용**되지만, DML 작업은 차단됩니다.
- LOCK=EXCLUSIVE: 
  - 모든 DML 및 SELECT **작업이 차단**됩니다.
- LOCK=DEFAULT:
  - MySQL이 자동으로 적절한 락 수준을 결정합니다.


## 제한 사항

-	메타데이터 락(MDL): DDL 작업 중에는 메타데이터 락이 발생하여, 다른 세션의 DML 작업이 일시적으로 대기 상태에 들어갈 수 있음
-	트랜잭션과의 충돌: 장시간 열린 트랜잭션이 있는 경우, DDL 작업이 지연되거나 실패할 수 있음.
-	리소스 사용량: 대용량 테이블에서의 DDL 작업은 CPU, 메모리, 디스크 I/O 등의 리소스를 많이 사용
-	지원되지 않는 작업: 일부 스키마 변경 작업은 온라인 DDL로 수행 불가능