# CloudTrail

AWS 계정에서 이루어지는 API 호출 및 이벤트를 추적하고 기록하는 서비스
누가, 언제, 어떤 리소스에 대해 어떤 작업을 수행했는지 확인

## 기능 

1.	이벤트 기록: AWS 계정에서 발생하는 모든 API 호출을 기록합니다. API 호출은 AWS Management Console, SDK, CLI 등을 통해 발생할 수 있으며, EC2 인스턴스 생성, S3 버킷 접근 등과 같은 활동이 포함됩니다.
2.	지속적인 모니터링: CloudTrail은 지속적으로 이벤트를 캡처하여 S3 버킷에 저장하고, 선택적으로 Amazon CloudWatch Logs로 전송하여 실시간 모니터링을 할 수 있습니다. 이를 통해 이상 징후나 보안 위협을 신속히 감지할 수 있습니다.
3.	관리 이벤트 및 데이터 이벤트: 관리 이벤트는 계정 리소스 관리에 관한 기록을 포함하며, 데이터 이벤트는 S3나 Lambda와 같은 특정 서비스의 개별 객체나 함수 수준의 호출을 기록합니다. 데이터 이벤트는 주로 중요한 리소스에 대한 접근 기록을 남기기 위해 사용됩니다.
4.	다양한 로그 분석: 기록된 로그는 AWS CloudTrail 콘솔, Athena, Amazon CloudWatch를 통해 조회 및 분석할 수 있습니다. 이를 통해 특정 이벤트에 대한 자세한 정보를 확인하거나, 이벤트 패턴 분석 등을 수행할 수 있습니다.
5.	멀티 리전 및 멀티 계정: CloudTrail은 멀티 리전 및 멀티 계정을 지원하여 AWS 환경 전반에 대한 일관된 모니터링이 가능합니다. 여러 계정에 대한 이벤트를 통합할 수 있어 관리가 편리해집니다.
6.	보안 및 감사: CloudTrail은 중요한 보안 정보를 제공합니다. 예를 들어, 계정 내에서 권한이 없는 사용자가 리소스에 접근하려 할 경우, 이 기록을 통해 보안 침해 시도를 추적할 수 있습니다.

## 저장 디렉토리

1. cloudtrail 디렉토리

-	내용: 이 디렉토리는 **AWS CloudTrail 이벤트 로그 파일이 저장되는 위치**입니다. 여기에는 AWS에서 발생한 API 호출과 관련된 세부 정보가 기록됩니다.
-	로그 파일 구성: 각 로그 파일은 **JSON 형식**으로 기록되며, 특정 시간대에 발생한 API 호출 이벤트가 포함됩니다. 파일에는 API 호출이 발생한 시각, 실행 주체(사용자, 서비스 등), 리소스 정보, 액션 유형 등이 상세히 기록됩니다.
-	주요 목적: CloudTrail 로그 파일 자체가 API 활동에 대한 기록이므로, 추후 보안 감사나 문제 해결 시 사용됩니다.

2. cloudtrail-digest 디렉토리

-	내용: 이 디렉토리는 CloudTrail **로그 파일의 무결성을 검증하는 데 사용되는 다이제스트 파일(digest file)을 저장**합니다. 다이제스트 파일에는 **CloudTrail 로그의 해시값이 포함**되어 있으며, 특정 시간 동안 기록된 로그 파일이 변조되지 않았음을 보장하기 위한 용도로 사용됩니다.
-	로그 파일 구성: 다이제스트 파일에는 SHA-256 해시가 포함되며, 각 로그 파일에 대한 해시값이 나열되어 있습니다. 이를 통해 로그 파일이 수정되거나 삭제되지 않았음을 확인할 수 있습니다.
-	주요 목적: cloudtrail-digest 디렉토리는 보안 및 규정 준수 요구 사항을 충족하기 위한 검증 자료를 제공합니다. 로그 무결성 검증을 통해 감사 또는 조사 시점에서 해당 로그 파일이 안전하게 보관되었음을 보장합니다.

## 추적

CloudTrail은 기본적으로 모든 AWS 계정에서 활성화되어 지난 90일간의 관리 이벤트를 "이벤트 기록"에서 보여줍니다. 하지만 다음과 같은 경우 "추적"을 생성하고 설정해야 합니다:

장기 로그 보관: 90일 이상 로그를 보관해야 할 경우 (규정 준수 요건 등)
특정 S3 버킷으로 로그 전송: 로그 파일을 지정된 S3 버킷에 안전하게 저장하고 관리하고 싶을 때
모든 리전의 로그 통합: 여러 AWS 리전에서 발생하는 모든 활동을 하나의 S3 버킷이나 CloudWatch Logs 그룹으로 통합하여 관리하고 싶을 때
로그 파일 암호화: SSE-KMS를 사용하여 로그 파일을 더욱 강력하게 암호화하고 싶을 때
CloudWatch Logs와 통합: 로그를 CloudWatch Logs로 전송하여 실시간 모니터링, 특정 이벤트에 대한 경보 설정, 고급 검색 및 분석을 하고 싶을 때
SNS 알림: 새 로그 파일이 S3 버킷으로 전송될 때마다 알림을 받고 싶을 때
데이터 이벤트 또는 인사이트 이벤트 로깅: S3 객체 수준 활동, Lambda 함수 실행과 같은 데이터 이벤트나 비정상적인 API 활동을 감지하는 인사이트 이벤트를 기록하고 싶을 때
조직 전체의 로그 관리 (Organization Trail): AWS Organizations를 사용하는 경우, 조직 내 모든 계정의 로그를 중앙에서 관리하고 싶을 때



## 관리 이벤트(Management events)
관리 이벤트는 AWS 계정의 리소스에서 수행되는 관리 작업에 대한 정보를 제공합니다. 이러한 작업은 "컨트롤 플레인(control plane) 작업"이라고도 불립니다. 여기에는 다음과 같은 유형의 이벤트들이 포함됩니다:

보안 구성 변경:
IAM 사용자, 역할, 정책 생성, 수정, 삭제 (예: CreateUser, AttachRolePolicy)
보안 그룹 및 네트워크 ACL 변경 (예: AuthorizeSecurityGroupIngress)
S3 버킷 정책 변경 (예: PutBucketPolicy)
리소스 라이프사이클 관리:
EC2 인스턴스 시작, 중지, 종료 (예: RunInstances, StopInstances, TerminateInstances)
S3 버킷 생성, 삭제 (예: CreateBucket, DeleteBucket)
RDS 인스턴스 생성, 수정, 삭제 (예: CreateDBInstance)
VPC, 서브넷, 라우팅 테이블 등의 네트워크 리소스 변경
로깅 및 모니터링 설정 변경:
CloudTrail 추적 생성 또는 수정
CloudWatch 경보 생성 또는 수정
AWS Management Console 로그인:
사용자가 AWS Management Console에 로그인하거나 로그인에 실패한 이벤트 (ConsoleLogin)
기타 AWS 서비스의 리소스 설정 및 구성 변경 작업
